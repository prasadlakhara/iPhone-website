import{r as f,j as G}from"./react-CjcYw1es.js";import{m as Re,T as Ge,R as un,f as fn,n as dn,o as pn,p as xt,q as Mt,O as Ue,r as Xe,S as Pe,s as Oe,t as mn,A as vn,u as Ye,V as X,a as hn,v as gn,w as yn,x as bn,y as wn,z as En,E as _n,G as St,J as Ke,W as Cn,L as ft,H as Rt,K as Pn,F as xn,Q as Mn,X as Sn,Y as Rn,Z as On}from"./three-BF1wJDGd.js";import{c as dt}from"./debounce-BAycNjwc.js";import{F as jn,u as kn}from"./its-fine-zVMOMI9b.js";import{R as Tn,c as ce}from"./react-reconciler-D6crHzGB.js";import{_ as Q}from"./@babel-CF3RwP-h.js";import{c as Ln}from"./react-dom-DD_eI6nd.js";import{G as Ze,D as An,M as je,O as zn,R as Dn,E as In,a as Fn}from"./three-stdlib-Bz4liEo7.js";import{H as Bn,G as Hn}from"./@monogrid-BhB3i6vo.js";import{t as $n}from"./tunnel-rat-RDQCgVYf.js";import{c as Ot}from"./zustand-f8RDaRX1.js";import{s as Wn,p as Gn,c as Nn}from"./suspend-react-BKIKQNXN.js";function eo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jt={exports:{}},kt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(E,M){var x=E.length;E.push(M);e:for(;0<x;){var O=x-1>>>1,A=E[O];if(0<s(A,M))E[O]=M,E[x]=A,x=O;else break e}}function o(E){return E.length===0?null:E[0]}function i(E){if(E.length===0)return null;var M=E[0],x=E.pop();if(x!==M){E[0]=x;e:for(var O=0,A=E.length,L=A>>>1;O<L;){var W=2*(O+1)-1,V=E[W],K=W+1,re=E[K];if(0>s(V,x))K<A&&0>s(re,V)?(E[O]=re,E[K]=x,O=K):(E[O]=V,E[W]=x,O=W);else if(K<A&&0>s(re,x))E[O]=re,E[K]=x,O=K;else break e}}return M}function s(E,M){var x=E.sortIndex-M.sortIndex;return x!==0?x:E.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var d=Date,u=d.now();e.unstable_now=function(){return d.now()-u}}var l=[],v=[],r=1,n=null,a=3,m=!1,g=!1,b=!1,h=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(E){for(var M=o(v);M!==null;){if(M.callback===null)i(v);else if(M.startTime<=E)i(v),M.sortIndex=M.expirationTime,t(l,M);else break;M=o(v)}}function S(E){if(b=!1,C(E),!g)if(o(l)!==null)g=!0,N(P);else{var M=o(v);M!==null&&H(S,M.startTime-E)}}function P(E,M){g=!1,b&&(b=!1,p(j),j=-1),m=!0;var x=a;try{for(C(M),n=o(l);n!==null&&(!(n.expirationTime>M)||E&&!_());){var O=n.callback;if(typeof O=="function"){n.callback=null,a=n.priorityLevel;var A=O(n.expirationTime<=M);M=e.unstable_now(),typeof A=="function"?n.callback=A:n===o(l)&&i(l),C(M)}else i(l);n=o(l)}if(n!==null)var L=!0;else{var W=o(v);W!==null&&H(S,W.startTime-M),L=!1}return L}finally{n=null,a=x,m=!1}}var w=!1,k=null,j=-1,R=5,T=-1;function _(){return!(e.unstable_now()-T<R)}function z(){if(k!==null){var E=e.unstable_now();T=E;var M=!0;try{M=k(!0,E)}finally{M?$():(w=!1,k=null)}}else w=!1}var $;if(typeof y=="function")$=function(){y(z)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,B=Y.port2;Y.port1.onmessage=z,$=function(){B.postMessage(null)}}else $=function(){h(z,0)};function N(E){k=E,w||(w=!0,$())}function H(E,M){j=h(function(){E(e.unstable_now())},M)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(E){E.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,N(P))},e.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<E?Math.floor(1e3/E):5},e.unstable_getCurrentPriorityLevel=function(){return a},e.unstable_getFirstCallbackNode=function(){return o(l)},e.unstable_next=function(E){switch(a){case 1:case 2:case 3:var M=3;break;default:M=a}var x=a;a=M;try{return E()}finally{a=x}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(E,M){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var x=a;a=E;try{return M()}finally{a=x}},e.unstable_scheduleCallback=function(E,M,x){var O=e.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?O+x:O):x=O,E){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=x+A,E={id:r++,callback:M,priorityLevel:E,startTime:x,expirationTime:A,sortIndex:-1},x>O?(E.sortIndex=x,t(v,E),o(l)===null&&E===o(v)&&(b?(p(j),j=-1):b=!0,H(S,x-O))):(E.sortIndex=A,t(l,E),g||m||(g=!0,N(P))),E},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(E){var M=a;return function(){var x=a;a=M;try{return E.apply(this,arguments)}finally{a=x}}}})(kt);jt.exports=kt;var pt=jt.exports;const Je={},Tt=e=>void Object.assign(Je,e);function Vn(e,t){function o(r,{args:n=[],attach:a,...m},g){let b=`${r[0].toUpperCase()}${r.slice(1)}`,h;if(r==="primitive"){if(m.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const p=m.object;h=se(p,{type:r,root:g,attach:a,primitive:!0})}else{const p=Je[b];if(!p)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");h=se(new p(...n),{type:r,root:g,attach:a,memoizedProps:{args:n}})}return h.__r3f.attach===void 0&&(h instanceof dn?h.__r3f.attach="geometry":h instanceof pn&&(h.__r3f.attach="material")),b!=="inject"&&Le(h,m),h}function i(r,n){let a=!1;if(n){var m,g;(m=n.__r3f)!=null&&m.attach?Te(r,n,n.__r3f.attach):n.isObject3D&&r.isObject3D&&(r.add(n),a=!0),a||(g=r.__r3f)==null||g.objects.push(n),n.__r3f||se(n,{}),n.__r3f.parent=r,Ve(n),ae(n)}}function s(r,n,a){let m=!1;if(n){var g,b;if((g=n.__r3f)!=null&&g.attach)Te(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){n.parent=r,n.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:n});const h=r.children.filter(y=>y!==n),p=h.indexOf(a);r.children=[...h.slice(0,p),n,...h.slice(p)],m=!0}m||(b=r.__r3f)==null||b.objects.push(n),n.__r3f||se(n,{}),n.__r3f.parent=r,Ve(n),ae(n)}}function c(r,n,a=!1){r&&[...r].forEach(m=>d(n,m,a))}function d(r,n,a){if(n){var m,g,b;if(n.__r3f&&(n.__r3f.parent=null),(m=r.__r3f)!=null&&m.objects&&(r.__r3f.objects=r.__r3f.objects.filter(S=>S!==n)),(g=n.__r3f)!=null&&g.attach)yt(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){var h;r.remove(n),(h=n.__r3f)!=null&&h.root&&Qn(Ce(n),n)}const y=(b=n.__r3f)==null?void 0:b.primitive,C=!y&&(a===void 0?n.dispose!==null:a);if(!y){var p;c((p=n.__r3f)==null?void 0:p.objects,n,C),c(n.children,n,C)}if(delete n.__r3f,C&&n.dispose&&n.type!=="Scene"){const S=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?pt.unstable_scheduleCallback(pt.unstable_IdlePriority,S):S()}ae(r)}}function u(r,n,a,m){var g;const b=(g=r.__r3f)==null?void 0:g.parent;if(!b)return;const h=o(n,a,r.__r3f.root);if(r.children){for(const p of r.children)p.__r3f&&i(h,p);r.children=r.children.filter(p=>!p.__r3f)}r.__r3f.objects.forEach(p=>i(h,p)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||d(b,r),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),i(b,h),h.raycast&&h.__r3f.eventCount&&Ce(h).getState().internal.interaction.push(h),[m,m.alternate].forEach(p=>{p!==null&&(p.stateNode=h,p.ref&&(typeof p.ref=="function"?p.ref(h):p.ref.current=h))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Tn({createInstance:o,removeChild:d,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,n)=>{if(!n)return;const a=r.getState().scene;a.__r3f&&(a.__r3f.root=r,i(a,n))},removeChildFromContainer:(r,n)=>{n&&d(r.getState().scene,n)},insertInContainerBefore:(r,n,a)=>{if(!n||!a)return;const m=r.getState().scene;m.__r3f&&s(m,n,a)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var n;return!!((n=r==null?void 0:r.__r3f)!=null?n:{}).handlers},prepareUpdate(r,n,a,m){var g;if(((g=r==null?void 0:r.__r3f)!=null?g:{}).primitive&&m.object&&m.object!==r)return[!0];{const{args:h=[],children:p,...y}=m,{args:C=[],children:S,...P}=a;if(!Array.isArray(h))throw new Error("R3F: the args prop must be an array!");if(h.some((k,j)=>k!==C[j]))return[!0];const w=Bt(r,y,P,!0);return w.changes.length?[!1,w]:null}},commitUpdate(r,[n,a],m,g,b,h){n?u(r,m,b,h):Le(r,a)},commitMount(r,n,a,m){var g;const b=(g=r.__r3f)!=null?g:{};r.raycast&&b.handlers&&b.eventCount&&Ce(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>se(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var n;const{attach:a,parent:m}=(n=r.__r3f)!=null?n:{};a&&m&&yt(m,r,a),r.isObject3D&&(r.visible=!1),ae(r)},unhideInstance(r,n){var a;const{attach:m,parent:g}=(a=r.__r3f)!=null?a:{};m&&g&&Te(g,r,m),(r.isObject3D&&n.visible==null||n.visible)&&(r.visible=!0),ae(r)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():ce.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Le}}var mt,vt;const ke=e=>"colorSpace"in e||"outputColorSpace"in e,Lt=()=>{var e;return(e=Je.ColorManagement)!=null?e:null},At=e=>e&&e.isOrthographicCamera,qn=e=>e&&e.hasOwnProperty("current"),he=typeof window<"u"&&((mt=window.document)!=null&&mt.createElement||((vt=window.navigator)==null?void 0:vt.product)==="ReactNative")?f.useLayoutEffect:f.useEffect;function zt(e){const t=f.useRef(e);return he(()=>void(t.current=e),[e]),t}function Un({set:e}){return he(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Dt extends f.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Dt.getDerivedStateFromError=()=>({error:!0});const It="__default",ht=new Map,Xn=e=>e&&!!e.memoized&&!!e.changes;function Ft(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const de=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Ce(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e)||D.boo(e))return e===t;const c=D.obj(e);if(c&&i==="reference")return e===t;const d=D.arr(e);if(d&&o==="reference")return e===t;if((d||c)&&e===t)return!0;let u;for(u in e)if(!(u in t))return!1;if(c&&o==="shallow"&&i==="shallow"){for(u in s?t:e)if(!D.equ(e[u],t[u],{strict:s,objects:"reference"}))return!1}else for(u in s?t:e)if(e[u]!==t[u])return!1;if(D.und(u)){if(d&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Yn(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function Kn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function se(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ne(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return o=i.reduce((c,d)=>c[d],e),{target:o,key:s}}else return{target:o,key:t}}const gt=/-\d+$/;function Te(e,t,o){if(D.str(o)){if(gt.test(o)){const c=o.replace(gt,""),{target:d,key:u}=Ne(e,c);Array.isArray(d[u])||(d[u]=[])}const{target:i,key:s}=Ne(e,o);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=o(e,t)}function yt(e,t,o){var i,s;if(D.str(o)){const{target:c,key:d}=Ne(e,o),u=t.__r3f.previousAttach;u===void 0?delete c[d]:c[d]=u}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function Bt(e,{children:t,key:o,ref:i,...s},{children:c,key:d,ref:u,...l}={},v=!1){const r=e.__r3f,n=Object.entries(s),a=[];if(v){const g=Object.keys(l);for(let b=0;b<g.length;b++)s.hasOwnProperty(g[b])||n.unshift([g[b],It+"remove"])}n.forEach(([g,b])=>{var h;if((h=e.__r3f)!=null&&h.primitive&&g==="object"||D.equ(b,l[g]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(g))return a.push([g,b,!0,[]]);let p=[];g.includes("-")&&(p=g.split("-")),a.push([g,b,!1,p]);for(const y in s){const C=s[y];y.startsWith(`${g}-`)&&a.push([y,C,!1,y.split("-")])}});const m={...s};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(m.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(m.attach=r.memoizedProps.attach),{memoized:m,changes:a}}const Zn=typeof process<"u"&&!1;function Le(e,t){var o;const i=e.__r3f,s=i==null?void 0:i.root,c=s==null||s.getState==null?void 0:s.getState(),{memoized:d,changes:u}=Xn(t)?t:Bt(e,t),l=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=d);for(let r=0;r<u.length;r++){let[n,a,m,g]=u[r];if(ke(e)){const y="srgb",C="srgb-linear";n==="encoding"?(n="colorSpace",a=a===3001?y:C):n==="outputEncoding"&&(n="outputColorSpace",a=a===3001?y:C)}let b=e,h=b[n];if(g.length&&(h=g.reduce((p,y)=>p[y],e),!(h&&h.set))){const[p,...y]=g.reverse();b=y.reverse().reduce((C,S)=>C[S],e),n=p}if(a===It+"remove")if(b.constructor){let p=ht.get(b.constructor);p||(p=new b.constructor,ht.set(b.constructor,p)),a=p[n]}else a=0;if(m&&i)a?i.handlers[n]=a:delete i.handlers[n],i.eventCount=Object.keys(i.handlers).length;else if(h&&h.set&&(h.copy||h instanceof Re)){if(Array.isArray(a))h.fromArray?h.fromArray(a):h.set(...a);else if(h.copy&&a&&a.constructor&&(Zn?h.constructor.name===a.constructor.name:h.constructor===a.constructor))h.copy(a);else if(a!==void 0){const p=h instanceof xt;!p&&h.setScalar?h.setScalar(a):h instanceof Re&&a instanceof Re?h.mask=a.mask:h.set(a),!Lt()&&c&&!c.linear&&p&&h.convertSRGBToLinear()}}else if(b[n]=a,b[n]instanceof Ge&&b[n].format===un&&b[n].type===fn&&c){const p=b[n];ke(p)&&ke(c.gl)?p.colorSpace=c.gl.outputColorSpace:p.encoding=c.gl.outputEncoding}ae(e)}if(i&&i.parent&&e.raycast&&l!==i.eventCount){const r=Ce(e).getState().internal,n=r.interaction.indexOf(e);n>-1&&r.interaction.splice(n,1),i.eventCount&&r.interaction.push(e)}return!(u.length===1&&u[0][0]==="onUpdate")&&u.length&&(o=e.__r3f)!=null&&o.parent&&Ve(e),e}function ae(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function Ve(e){e.onUpdate==null||e.onUpdate(e)}function Ht(e,t){e.manual||(At(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Jn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ce.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ce.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ce.ContinuousEventPriority;default:return ce.DefaultEventPriority}}function $t(e,t,o,i){const s=o.get(t);s&&(o.delete(t),o.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Qn(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(s)}),o.capturedMap.forEach((i,s)=>{$t(o.capturedMap,t,i,s)})}function er(e){function t(l){const{internal:v}=e.getState(),r=l.offsetX-v.initialClick[0],n=l.offsetY-v.initialClick[1];return Math.round(Math.sqrt(r*r+n*n))}function o(l){return l.filter(v=>["Move","Over","Enter","Out","Leave"].some(r=>{var n;return(n=v.__r3f)==null?void 0:n.handlers["onPointer"+r]}))}function i(l,v){const r=e.getState(),n=new Set,a=[],m=v?v(r.internal.interaction):r.internal.interaction;for(let p=0;p<m.length;p++){const y=de(m[p]);y&&(y.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(l,r);function g(p){const y=de(p);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var C;y.events.compute==null||y.events.compute(l,y,(C=y.previousRoot)==null?void 0:C.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(p,!0):[]}let b=m.flatMap(g).sort((p,y)=>{const C=de(p.object),S=de(y.object);return!C||!S?p.distance-y.distance:S.events.priority-C.events.priority||p.distance-y.distance}).filter(p=>{const y=we(p);return n.has(y)?!1:(n.add(y),!0)});r.events.filter&&(b=r.events.filter(b,r));for(const p of b){let y=p.object;for(;y;){var h;(h=y.__r3f)!=null&&h.eventCount&&a.push({...p,eventObject:y}),y=y.parent}}if("pointerId"in l&&r.internal.capturedMap.has(l.pointerId))for(let p of r.internal.capturedMap.get(l.pointerId).values())n.has(we(p.intersection))||a.push(p.intersection);return a}function s(l,v,r,n){const a=e.getState();if(l.length){const m={stopped:!1};for(const g of l){const b=de(g.object)||a,{raycaster:h,pointer:p,camera:y,internal:C}=b,S=new X(p.x,p.y,0).unproject(y),P=T=>{var _,z;return(_=(z=C.capturedMap.get(T))==null?void 0:z.has(g.eventObject))!=null?_:!1},w=T=>{const _={intersection:g,target:v.target};C.capturedMap.has(T)?C.capturedMap.get(T).set(g.eventObject,_):C.capturedMap.set(T,new Map([[g.eventObject,_]])),v.target.setPointerCapture(T)},k=T=>{const _=C.capturedMap.get(T);_&&$t(C.capturedMap,g.eventObject,_,T)};let j={};for(let T in v){let _=v[T];typeof _!="function"&&(j[T]=_)}let R={...g,...j,pointer:p,intersections:l,stopped:m.stopped,delta:r,unprojectedPoint:S,ray:h.ray,camera:y,stopPropagation(){const T="pointerId"in v&&C.capturedMap.get(v.pointerId);if((!T||T.has(g.eventObject))&&(R.stopped=m.stopped=!0,C.hovered.size&&Array.from(C.hovered.values()).find(_=>_.eventObject===g.eventObject))){const _=l.slice(0,l.indexOf(g));c([..._,g])}},target:{hasPointerCapture:P,setPointerCapture:w,releasePointerCapture:k},currentTarget:{hasPointerCapture:P,setPointerCapture:w,releasePointerCapture:k},nativeEvent:v};if(n(R),m.stopped===!0)break}}return l}function c(l){const{internal:v}=e.getState();for(const r of v.hovered.values())if(!l.length||!l.find(n=>n.object===r.object&&n.index===r.index&&n.instanceId===r.instanceId)){const a=r.eventObject.__r3f,m=a==null?void 0:a.handlers;if(v.hovered.delete(we(r)),a!=null&&a.eventCount){const g={...r,intersections:l};m.onPointerOut==null||m.onPointerOut(g),m.onPointerLeave==null||m.onPointerLeave(g)}}}function d(l,v){for(let r=0;r<v.length;r++){const n=v[r].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(l)}}function u(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return v=>{const{internal:r}=e.getState();"pointerId"in v&&r.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(v.pointerId)&&(r.capturedMap.delete(v.pointerId),c([]))})}}return function(r){const{onPointerMissed:n,internal:a}=e.getState();a.lastEvent.current=r;const m=l==="onPointerMove",g=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",h=i(r,m?o:void 0),p=g?t(r):0;l==="onPointerDown"&&(a.initialClick=[r.offsetX,r.offsetY],a.initialHits=h.map(C=>C.eventObject)),g&&!h.length&&p<=2&&(d(r,a.interaction),n&&n(r)),m&&c(h);function y(C){const S=C.eventObject,P=S.__r3f,w=P==null?void 0:P.handlers;if(P!=null&&P.eventCount)if(m){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const k=we(C),j=a.hovered.get(k);j?j.stopped&&C.stopPropagation():(a.hovered.set(k,C),w.onPointerOver==null||w.onPointerOver(C),w.onPointerEnter==null||w.onPointerEnter(C))}w.onPointerMove==null||w.onPointerMove(C)}else{const k=w[l];k?(!g||a.initialHits.includes(S))&&(d(r,a.interaction.filter(j=>!a.initialHits.includes(j))),k(C)):g&&a.initialHits.includes(S)&&d(r,a.interaction.filter(j=>!a.initialHits.includes(j)))}}s(h,r,p,y)}}return{handlePointer:u}}const tr=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Wt=e=>!!(e!=null&&e.render),xe=f.createContext(null),nr=(e,t)=>{const o=Ot((u,l)=>{const v=new X,r=new X,n=new X;function a(p=l().camera,y=r,C=l().size){const{width:S,height:P,top:w,left:k}=C,j=S/P;y instanceof X?n.copy(y):n.set(...y);const R=p.getWorldPosition(v).distanceTo(n);if(At(p))return{width:S/p.zoom,height:P/p.zoom,top:w,left:k,factor:1,distance:R,aspect:j};{const T=p.fov*Math.PI/180,_=2*Math.tan(T/2)*R,z=_*(S/P);return{width:z,height:_,top:w,left:k,factor:S/z,distance:R,aspect:j}}}let m;const g=p=>u(y=>({performance:{...y.performance,current:p}})),b=new Ye;return{set:u,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(p=1)=>e(l(),p),advance:(p,y)=>t(p,y,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new En,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const p=l();m&&clearTimeout(m),p.performance.current!==p.performance.min&&g(p.performance.min),m=setTimeout(()=>g(l().performance.max),p.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:p=>u(y=>({...y,events:{...y.events,...p}})),setSize:(p,y,C,S,P)=>{const w=l().camera,k={width:p,height:y,top:S||0,left:P||0,updateStyle:C};u(j=>({size:k,viewport:{...j.viewport,...a(w,r,k)}}))},setDpr:p=>u(y=>{const C=Ft(p);return{viewport:{...y.viewport,dpr:C,initialDpr:y.viewport.initialDpr||C}}}),setFrameloop:(p="always")=>{const y=l().clock;y.stop(),y.elapsedTime=0,p!=="never"&&(y.start(),y.elapsedTime=0),u(()=>({frameloop:p}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:f.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(p,y,C)=>{const S=l().internal;return S.priority=S.priority+(y>0?1:0),S.subscribers.push({ref:p,priority:y,store:C}),S.subscribers=S.subscribers.sort((P,w)=>P.priority-w.priority),()=>{const P=l().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(y>0?1:0),P.subscribers=P.subscribers.filter(w=>w.ref!==p))}}}}}),i=o.getState();let s=i.size,c=i.viewport.dpr,d=i.camera;return o.subscribe(()=>{const{camera:u,size:l,viewport:v,gl:r,set:n}=o.getState();if(l.width!==s.width||l.height!==s.height||v.dpr!==c){var a;s=l,c=v.dpr,Ht(u,l),r.setPixelRatio(v.dpr);const m=(a=l.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(l.width,l.height,m)}u!==d&&(d=u,n(m=>({viewport:{...m.viewport,...m.viewport.getCurrentViewport(u)}})))}),o.subscribe(u=>e(u)),o};let Ee,rr=new Set,or=new Set,ir=new Set;function Ae(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function pe(e,t){switch(e){case"before":return Ae(rr,t);case"after":return Ae(or,t);case"tail":return Ae(ir,t)}}let ze,De;function Ie(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ze=t.internal.subscribers,Ee=0;Ee<ze.length;Ee++)De=ze[Ee],De.ref.current(De.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function sr(e){let t=!1,o=!1,i,s,c;function d(v){s=requestAnimationFrame(d),t=!0,i=0,pe("before",v),o=!0;for(const n of e.values()){var r;c=n.store.getState(),c.internal.active&&(c.frameloop==="always"||c.internal.frames>0)&&!((r=c.gl.xr)!=null&&r.isPresenting)&&(i+=Ie(v,c))}if(o=!1,pe("after",v),i===0)return pe("tail",v),t=!1,cancelAnimationFrame(s)}function u(v,r=1){var n;if(!v)return e.forEach(a=>u(a.store.getState(),r));(n=v.gl.xr)!=null&&n.isPresenting||!v.internal.active||v.frameloop==="never"||(r>1?v.internal.frames=Math.min(60,v.internal.frames+r):o?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(d)))}function l(v,r=!0,n,a){if(r&&pe("before",v),n)Ie(v,n,a);else for(const m of e.values())Ie(v,m.store.getState());r&&pe("after",v)}return{loop:d,invalidate:u,advance:l}}function Qe(){const e=f.useContext(xe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function F(e=o=>o,t){return Qe()(e,t)}function ge(e,t=0){const o=Qe(),i=o.getState().internal.subscribe,s=zt(e);return he(()=>i(s,t,o),[t,i,o]),null}const bt=new WeakMap;function Gt(e,t){return function(o,...i){let s=bt.get(o);return s||(s=new o,bt.set(o,s)),e&&e(s),Promise.all(i.map(c=>new Promise((d,u)=>s.load(c,l=>{l.scene&&Object.assign(l,Yn(l.scene)),d(l)},t,l=>u(new Error(`Could not load ${c}: ${l==null?void 0:l.message}`))))))}}function U(e,t,o,i){const s=Array.isArray(t)?t:[t],c=Wn(Gt(o,i),[e,...s],{equal:D.equ});return Array.isArray(t)?c:c[0]}U.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return Gn(Gt(o),[e,...i])};U.clear=function(e,t){const o=Array.isArray(t)?t:[t];return Nn([e,...o])};const ue=new Map,{invalidate:wt,advance:Et}=sr(ue),{reconciler:me,applyProps:J}=Vn(ue,Jn),ie={objects:"shallow",strict:!1},ar=(e,t)=>{const o=typeof e=="function"?e(t):e;return Wt(o)?o:new hn({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function cr(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:c,left:d,updateStyle:u=o}=t;return{width:i,height:s,top:c,left:d,updateStyle:u}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:c,left:d}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:c,left:d,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function lr(e){const t=ue.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,c=i||nr(wt,Et),d=o||me.createContainer(c,ce.ConcurrentRoot,null,!1,null,"",s,null);t||ue.set(e,{fiber:d,store:c});let u,l=!1,v;return{configure(r={}){let{gl:n,size:a,scene:m,events:g,onCreated:b,shadows:h=!1,linear:p=!1,flat:y=!1,legacy:C=!1,orthographic:S=!1,frameloop:P="always",dpr:w=[1,2],performance:k,raycaster:j,camera:R,onPointerMissed:T}=r,_=c.getState(),z=_.gl;_.gl||_.set({gl:z=ar(n,e)});let $=_.raycaster;$||_.set({raycaster:$=new Mt});const{params:Y,...B}=j||{};if(D.equ(B,$,ie)||J($,{...B}),D.equ(Y,$.params,ie)||J($,{params:{...$.params,...Y}}),!_.camera||_.camera===v&&!D.equ(v,R,ie)){v=R;const x=R instanceof gn,O=x?R:S?new Ue(0,0,0,0,.1,1e3):new Xe(75,0,.1,1e3);x||(O.position.z=5,R&&(J(O,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(O.manual=!0,O.updateProjectionMatrix())),!_.camera&&!(R!=null&&R.rotation)&&O.lookAt(0,0,0)),_.set({camera:O}),$.camera=O}if(!_.scene){let x;m instanceof Pe?x=m:(x=new Pe,m&&J(x,m)),_.set({scene:se(x)})}if(!_.xr){var N;const x=(L,W)=>{const V=c.getState();V.frameloop!=="never"&&Et(L,!0,V,W)},O=()=>{const L=c.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?x:null),L.gl.xr.isPresenting||wt(L)},A={connect(){const L=c.getState().gl;L.xr.addEventListener("sessionstart",O),L.xr.addEventListener("sessionend",O)},disconnect(){const L=c.getState().gl;L.xr.removeEventListener("sessionstart",O),L.xr.removeEventListener("sessionend",O)}};typeof((N=z.xr)==null?void 0:N.addEventListener)=="function"&&A.connect(),_.set({xr:A})}if(z.shadowMap){const x=z.shadowMap.enabled,O=z.shadowMap.type;if(z.shadowMap.enabled=!!h,D.boo(h))z.shadowMap.type=Oe;else if(D.str(h)){var H;const A={basic:yn,percentage:bn,soft:Oe,variance:wn};z.shadowMap.type=(H=A[h])!=null?H:Oe}else D.obj(h)&&Object.assign(z.shadowMap,h);(x!==z.shadowMap.enabled||O!==z.shadowMap.type)&&(z.shadowMap.needsUpdate=!0)}const E=Lt();E&&("enabled"in E?E.enabled=!C:"legacyMode"in E&&(E.legacyMode=C)),l||J(z,{outputEncoding:p?3e3:3001,toneMapping:y?mn:vn}),_.legacy!==C&&_.set(()=>({legacy:C})),_.linear!==p&&_.set(()=>({linear:p})),_.flat!==y&&_.set(()=>({flat:y})),n&&!D.fun(n)&&!Wt(n)&&!D.equ(n,z,ie)&&J(z,n),g&&!_.events.handlers&&_.set({events:g(c)});const M=cr(e,a);return D.equ(M,_.size,ie)||_.setSize(M.width,M.height,M.updateStyle,M.top,M.left),w&&_.viewport.dpr!==Ft(w)&&_.setDpr(w),_.frameloop!==P&&_.setFrameloop(P),_.onPointerMissed||_.set({onPointerMissed:T}),k&&!D.equ(k,_.performance,ie)&&_.set(x=>({performance:{...x.performance,...k}})),u=b,l=!0,this},render(r){return l||this.configure(),me.updateContainer(G.jsx(ur,{store:c,children:r,onCreated:u,rootElement:e}),d,null,()=>{}),c},unmount(){Nt(e)}}}function ur({store:e,children:t,onCreated:o,rootElement:i}){return he(()=>{const s=e.getState();s.set(c=>({internal:{...c.internal,active:!0}})),o&&o(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),G.jsx(xe.Provider,{value:e,children:t})}function Nt(e,t){const o=ue.get(e),i=o==null?void 0:o.fiber;if(i){const s=o==null?void 0:o.store.getState();s&&(s.internal.active=!1),me.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var c,d,u,l;s.events.disconnect==null||s.events.disconnect(),(c=s.gl)==null||(d=c.renderLists)==null||d.dispose==null||d.dispose(),(u=s.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(l=s.gl)!=null&&l.xr&&s.xr.disconnect(),Kn(s),ue.delete(e)}catch{}},500)})}}function Vt(e,t,o){return G.jsx(fr,{children:e,container:t,state:o},t.uuid)}function fr({state:e={},children:t,container:o}){const{events:i,size:s,...c}=e,d=Qe(),[u]=f.useState(()=>new Mt),[l]=f.useState(()=>new Ye),v=f.useCallback((n,a)=>{const m={...n};Object.keys(n).forEach(b=>{(tr.includes(b)||n[b]!==a[b]&&a[b])&&delete m[b]});let g;if(a&&s){const b=a.camera;g=n.viewport.getCurrentViewport(b,new X,s),b!==n.camera&&Ht(b,s)}return{...m,scene:o,raycaster:u,pointer:l,mouse:l,previousRoot:d,events:{...n.events,...a==null?void 0:a.events,...i},size:{...n.size,...s},viewport:{...n.viewport,...g},...c}},[e]),[r]=f.useState(()=>{const n=d.getState();return Ot((m,g)=>({...n,scene:o,raycaster:u,pointer:l,mouse:l,previousRoot:d,events:{...n.events,...i},size:{...n.size,...s},...c,set:m,get:g,setEvents:b=>m(h=>({...h,events:{...h.events,...b}}))}))});return f.useEffect(()=>{const n=d.subscribe(a=>r.setState(m=>v(a,m)));return()=>{n()}},[v]),f.useEffect(()=>{r.setState(n=>v(d.getState(),n))},[v]),f.useEffect(()=>()=>{r.destroy()},[]),G.jsx(G.Fragment,{children:me.createPortal(G.jsx(xe.Provider,{value:r,children:t}),r,null)})}me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:f.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function dr(e){const{handlePointer:t}=er(e);return{priority:1,enabled:!0,compute(o,i,s){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:s}=e.getState();(o=s.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:o=>{var i;const{set:s,events:c}=e.getState();c.disconnect==null||c.disconnect(),s(d=>({events:{...d.events,connected:o}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([d,u])=>{const[l,v]=Fe[d];o.addEventListener(l,u,{passive:v})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([c,d])=>{if(i&&i.connected instanceof HTMLElement){const[u]=Fe[c];i.connected.removeEventListener(u,d)}}),o(c=>({events:{...c.events,connected:void 0}}))}}}}function pr({debounce:e,scroll:t,polyfill:o,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const s=o||typeof window<"u"&&window.ResizeObserver,[c,d]=f.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!s)return c.width=1280,c.height=800,[()=>{},c,()=>{}];const u=f.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:c}),l=e?typeof e=="number"?e:e.scroll:null,v=e?typeof e=="number"?e:e.resize:null,r=f.useRef(!1);f.useEffect(()=>(r.current=!0,()=>void(r.current=!1)));const[n,a,m]=f.useMemo(()=>{const p=()=>{if(!u.current.element)return;const{left:y,top:C,width:S,height:P,bottom:w,right:k,x:j,y:R}=u.current.element.getBoundingClientRect(),T={left:y,top:C,width:S,height:P,bottom:w,right:k,x:j,y:R};u.current.element instanceof HTMLElement&&i&&(T.height=u.current.element.offsetHeight,T.width=u.current.element.offsetWidth),Object.freeze(T),r.current&&!gr(u.current.lastBounds,T)&&d(u.current.lastBounds=T)};return[p,v?dt(p,v):p,l?dt(p,l):p]},[d,i,l,v]);function g(){u.current.scrollContainers&&(u.current.scrollContainers.forEach(p=>p.removeEventListener("scroll",m,!0)),u.current.scrollContainers=null),u.current.resizeObserver&&(u.current.resizeObserver.disconnect(),u.current.resizeObserver=null)}function b(){u.current.element&&(u.current.resizeObserver=new s(m),u.current.resizeObserver.observe(u.current.element),t&&u.current.scrollContainers&&u.current.scrollContainers.forEach(p=>p.addEventListener("scroll",m,{capture:!0,passive:!0})))}const h=p=>{!p||p===u.current.element||(g(),u.current.element=p,u.current.scrollContainers=qt(p),b())};return vr(m,!!t),mr(a),f.useEffect(()=>{g(),b()},[t,m,a]),f.useEffect(()=>g,[]),[h,c,n]}function mr(e){f.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function vr(e,t){f.useEffect(()=>{if(t){const o=e;return window.addEventListener("scroll",o,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",o,!0)}},[e,t])}function qt(e){const t=[];if(!e||e===document.body)return t;const{overflow:o,overflowX:i,overflowY:s}=window.getComputedStyle(e);return[o,i,s].some(c=>c==="auto"||c==="scroll")&&t.push(e),[...t,...qt(e.parentElement)]}const hr=["x","y","top","bottom","left","right","width","height"],gr=(e,t)=>hr.every(o=>e[o]===t[o]),yr=f.forwardRef(function({children:t,fallback:o,resize:i,style:s,gl:c,events:d=dr,eventSource:u,eventPrefix:l,shadows:v,linear:r,flat:n,legacy:a,orthographic:m,frameloop:g,dpr:b,performance:h,raycaster:p,camera:y,scene:C,onPointerMissed:S,onCreated:P,...w},k){f.useMemo(()=>Tt(_n),[]);const j=kn(),[R,T]=pr({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=f.useRef(null),z=f.useRef(null);f.useImperativeHandle(k,()=>_.current);const $=zt(S),[Y,B]=f.useState(!1),[N,H]=f.useState(!1);if(Y)throw Y;if(N)throw N;const E=f.useRef(null);he(()=>{const x=_.current;T.width>0&&T.height>0&&x&&(E.current||(E.current=lr(x)),E.current.configure({gl:c,events:d,shadows:v,linear:r,flat:n,legacy:a,orthographic:m,frameloop:g,dpr:b,performance:h,raycaster:p,camera:y,scene:C,size:T,onPointerMissed:(...O)=>$.current==null?void 0:$.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(u?qn(u)?u.current:u:z.current),l&&O.setEvents({compute:(A,L)=>{const W=A[l+"X"],V=A[l+"Y"];L.pointer.set(W/L.size.width*2-1,-(V/L.size.height)*2+1),L.raycaster.setFromCamera(L.pointer,L.camera)}}),P==null||P(O)}}),E.current.render(G.jsx(j,{children:G.jsx(Dt,{set:H,children:G.jsx(f.Suspense,{fallback:G.jsx(Un,{set:B}),children:t})})})))}),f.useEffect(()=>{const x=_.current;if(x)return()=>Nt(x)},[]);const M=u?"none":"auto";return G.jsx("div",{ref:z,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:M,...s},...w,children:G.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:_,style:{display:"block"},children:o})})})}),to=f.forwardRef(function(t,o){return G.jsx(jn,{children:G.jsx(yr,{...t,ref:o})})}),ye=new X,et=new X,br=new X,_t=new Ye;function wr(e,t,o){const i=ye.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=o.width/2,c=o.height/2;return[i.x*s+s,-(i.y*c)+c]}function Er(e,t){const o=ye.setFromMatrixPosition(e.matrixWorld),i=et.setFromMatrixPosition(t.matrixWorld),s=o.sub(i),c=t.getWorldDirection(br);return s.angleTo(c)>Math.PI/2}function _r(e,t,o,i){const s=ye.setFromMatrixPosition(e.matrixWorld),c=s.clone();c.project(t),_t.set(c.x,c.y),o.setFromCamera(_t,t);const d=o.intersectObjects(i,!0);if(d.length){const u=d[0].distance;return s.distanceTo(o.ray.origin)<u}return!0}function Cr(e,t){if(t instanceof Ue)return t.zoom;if(t instanceof Xe){const o=ye.setFromMatrixPosition(e.matrixWorld),i=et.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,c=o.distanceTo(i);return 1/(2*Math.tan(s/2)*c)}else return 1}function Pr(e,t,o){if(t instanceof Xe||t instanceof Ue){const i=ye.setFromMatrixPosition(e.matrixWorld),s=et.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(s),d=(o[1]-o[0])/(t.far-t.near),u=o[1]-d*t.far;return Math.round(d*c+u)}}const qe=e=>Math.abs(e)<1e-10?0:e;function Ut(e,t,o=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=qe(t[s]*e.elements[s])+(s!==15?",":")");return o+i}const xr=(e=>t=>Ut(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Mr=(e=>(t,o)=>Ut(t,e(o),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Sr(e){return e&&typeof e=="object"&&"current"in e}const no=f.forwardRef(({children:e,eps:t=.001,style:o,className:i,prepend:s,center:c,fullscreen:d,portal:u,distanceFactor:l,sprite:v=!1,transform:r=!1,occlude:n,onOcclude:a,castShadow:m,receiveShadow:g,material:b,geometry:h,zIndexRange:p=[16777271,0],calculatePosition:y=wr,as:C="div",wrapperClass:S,pointerEvents:P="auto",...w},k)=>{const{gl:j,camera:R,scene:T,size:_,raycaster:z,events:$,viewport:Y}=F(),[B]=f.useState(()=>document.createElement(C)),N=f.useRef(),H=f.useRef(null),E=f.useRef(0),M=f.useRef([0,0]),x=f.useRef(null),O=f.useRef(null),A=(u==null?void 0:u.current)||$.connected||j.domElement.parentNode,L=f.useRef(null),W=f.useRef(!1),V=f.useMemo(()=>n&&n!=="blending"||Array.isArray(n)&&n.length&&Sr(n[0]),[n]);f.useLayoutEffect(()=>{const q=j.domElement;n&&n==="blending"?(q.style.zIndex=`${Math.floor(p[0]/2)}`,q.style.position="absolute",q.style.pointerEvents="none"):(q.style.zIndex=null,q.style.position=null,q.style.pointerEvents=null)},[n]),f.useLayoutEffect(()=>{if(H.current){const q=N.current=Ln(B);if(T.updateMatrixWorld(),r)B.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=y(H.current,R,_);B.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return A&&(s?A.prepend(B):A.appendChild(B)),()=>{A&&A.removeChild(B),q.unmount()}}},[A,r]),f.useLayoutEffect(()=>{S&&(B.className=S)},[S]);const K=f.useMemo(()=>r?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...d&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...o},[o,c,d,_,r]),re=f.useMemo(()=>({position:"absolute",pointerEvents:P}),[P]);f.useLayoutEffect(()=>{if(W.current=!1,r){var q;(q=N.current)==null||q.render(f.createElement("div",{ref:x,style:K},f.createElement("div",{ref:O,style:re},f.createElement("div",{ref:k,className:i,style:o,children:e}))))}else{var I;(I=N.current)==null||I.render(f.createElement("div",{ref:k,style:K,className:i,children:e}))}});const oe=f.useRef(!0);ge(q=>{if(H.current){R.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const I=r?M.current:y(H.current,R,_);if(r||Math.abs(E.current-R.zoom)>t||Math.abs(M.current[0]-I[0])>t||Math.abs(M.current[1]-I[1])>t){const ee=Er(H.current,R);let Z=!1;V&&(Array.isArray(n)?Z=n.map(te=>te.current):n!=="blending"&&(Z=[T]));const fe=oe.current;if(Z){const te=_r(H.current,R,z,Z);oe.current=te&&!ee}else oe.current=!ee;fe!==oe.current&&(a?a(!oe.current):B.style.display=oe.current?"block":"none");const be=Math.floor(p[0]/2),nn=n?V?[p[0],be]:[be-1,0]:p;if(B.style.zIndex=`${Pr(H.current,R,nn)}`,r){const[te,lt]=[_.width/2,_.height/2],Se=R.projectionMatrix.elements[5]*lt,{isOrthographicCamera:ut,top:rn,left:on,bottom:sn,right:an}=R,cn=xr(R.matrixWorldInverse),ln=ut?`scale(${Se})translate(${qe(-(an+on)/2)}px,${qe((rn+sn)/2)}px)`:`translateZ(${Se}px)`;let ne=H.current.matrixWorld;v&&(ne=R.matrixWorldInverse.clone().transpose().copyPosition(ne).scale(H.current.scale),ne.elements[3]=ne.elements[7]=ne.elements[11]=0,ne.elements[15]=1),B.style.width=_.width+"px",B.style.height=_.height+"px",B.style.perspective=ut?"":`${Se}px`,x.current&&O.current&&(x.current.style.transform=`${ln}${cn}translate(${te}px,${lt}px)`,O.current.style.transform=Mr(ne,1/((l||10)/400)))}else{const te=l===void 0?1:Cr(H.current,R)*l;B.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${te})`}M.current=I,E.current=R.zoom}}if(!V&&L.current&&!W.current)if(r){if(x.current){const I=x.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:ee}=R;if(ee||h)w.scale&&(Array.isArray(w.scale)?w.scale instanceof X?L.current.scale.copy(w.scale.clone().divideScalar(1)):L.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):L.current.scale.setScalar(1/w.scale));else{const Z=(l||10)/400,fe=I.clientWidth*Z,be=I.clientHeight*Z;L.current.scale.set(fe,be,1)}W.current=!0}}}else{const I=B.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const ee=1/Y.factor,Z=I.clientWidth*ee,fe=I.clientHeight*ee;L.current.scale.set(Z,fe,1),W.current=!0}L.current.lookAt(q.camera.position)}});const ct=f.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return f.createElement("group",Q({},w,{ref:H}),n&&!V&&f.createElement("mesh",{castShadow:m,receiveShadow:g,ref:L},h||f.createElement("planeGeometry",null),b||f.createElement("shaderMaterial",{side:St,vertexShader:ct.vertexShader,fragmentShader:ct.fragmentShader})))}),Be=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Xt(e,t){const o=F(c=>c.gl),i=U(Ke,Be(e)?Object.values(e):e);return f.useLayoutEffect(()=>{t==null||t(i)},[t]),f.useEffect(()=>{if("initTexture"in o){let c=[];Array.isArray(i)?c=i:i instanceof Ge?c=[i]:Be(i)&&(c=Object.values(i)),c.forEach(d=>{d instanceof Ge&&o.initTexture(d)})}},[o,i]),f.useMemo(()=>{if(Be(e)){const c={};let d=0;for(const u in e)c[u]=i[d++];return c}else return i},[e,i])}Xt.preload=e=>U.preload(Ke,e);Xt.clear=e=>U.clear(Ke,e);let _e=null,Yt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Kt(e,t,o){return i=>{o&&o(i),e&&(_e||(_e=new An),_e.setDecoderPath(typeof e=="string"?e:Yt),i.setDRACOLoader(_e)),t&&i.setMeshoptDecoder(typeof je=="function"?je():je)}}function tt(e,t=!0,o=!0,i){return U(Ze,e,Kt(t,o,i))}tt.preload=(e,t=!0,o=!0,i)=>U.preload(Ze,e,Kt(t,o,i));tt.clear=e=>U.clear(Ze,e);tt.setDecoderPath=e=>{Yt=e};function Rr(e,t,o){const i=F(a=>a.size),s=F(a=>a.viewport),c=typeof e=="number"?e:i.width*s.dpr,d=i.height*s.dpr,u=(typeof e=="number"?o:e)||{},{samples:l=0,depth:v,...r}=u,n=f.useMemo(()=>{const a=new Cn(c,d,{minFilter:ft,magFilter:ft,type:Rt,...r});return v&&(a.depthTexture=new Pn(c,d,xn)),a.samples=l,a},[]);return f.useLayoutEffect(()=>{n.setSize(c,d),l&&(n.samples=l)},[l,n,c,d]),f.useEffect(()=>()=>n.dispose(),[]),n}const Or=e=>typeof e=="function",ro=f.forwardRef(({envMap:e,resolution:t=256,frames:o=1/0,makeDefault:i,children:s,...c},d)=>{const u=F(({set:h})=>h),l=F(({camera:h})=>h),v=F(({size:h})=>h),r=f.useRef(null);f.useImperativeHandle(d,()=>r.current,[]);const n=f.useRef(null),a=Rr(t);f.useLayoutEffect(()=>{c.manual||(r.current.aspect=v.width/v.height)},[v,c]),f.useLayoutEffect(()=>{r.current.updateProjectionMatrix()});let m=0,g=null;const b=Or(s);return ge(h=>{b&&(o===1/0||m<o)&&(n.current.visible=!1,h.gl.setRenderTarget(a),g=h.scene.background,e&&(h.scene.background=e),h.gl.render(h.scene,r.current),h.scene.background=g,h.gl.setRenderTarget(null),n.current.visible=!0,m++)}),f.useLayoutEffect(()=>{if(i){const h=l;return u(()=>({camera:r.current})),()=>u(()=>({camera:h}))}},[r,i,u]),f.createElement(f.Fragment,null,f.createElement("perspectiveCamera",Q({ref:r},c),!b&&s),f.createElement("group",{ref:n},b&&s(a.texture)))}),oo=f.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:s=!0,keyEvents:c=!1,onChange:d,onStart:u,onEnd:l,...v},r)=>{const n=F(w=>w.invalidate),a=F(w=>w.camera),m=F(w=>w.gl),g=F(w=>w.events),b=F(w=>w.setEvents),h=F(w=>w.set),p=F(w=>w.get),y=F(w=>w.performance),C=t||a,S=i||g.connected||m.domElement,P=f.useMemo(()=>new zn(C),[C]);return ge(()=>{P.enabled&&P.update()},-1),f.useEffect(()=>(c&&P.connect(c===!0?S:c),P.connect(S),()=>void P.dispose()),[c,S,o,P,n]),f.useEffect(()=>{const w=R=>{n(),o&&y.regress(),d&&d(R)},k=R=>{u&&u(R)},j=R=>{l&&l(R)};return P.addEventListener("change",w),P.addEventListener("start",k),P.addEventListener("end",j),()=>{P.removeEventListener("start",k),P.removeEventListener("end",j),P.removeEventListener("change",w)}},[d,u,l,P,n,b]),f.useEffect(()=>{if(e){const w=p().controls;return h({controls:P}),()=>h({controls:w})}},[e,P]),f.createElement("primitive",Q({ref:r,object:P,enableDamping:s},v))}),jr=3e3,kr=3001,ve={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Zt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",le=e=>Array.isArray(e),nt=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Me({files:e=nt,path:t="",preset:o=void 0,encoding:i=void 0,extensions:s}={}){let c=null,d=!1;o&&(rt(o),e=ve[o],t=Zt),d=le(e);const{extension:u,isCubemap:l}=ot(e);if(c=it(u),!c)throw new Error("useEnvironment: Unrecognized file extension: "+e);const v=F(m=>m.gl);f.useLayoutEffect(()=>{if(u!=="webp"&&u!=="jpg"&&u!=="jpeg")return;function m(){U.clear(c,d?[e]:e)}v.domElement.addEventListener("webglcontextlost",m,{once:!0})},[e,v.domElement]);const r=U(c,d?[e]:e,m=>{(u==="webp"||u==="jpg"||u==="jpeg")&&m.setRenderer(v),m.setPath==null||m.setPath(t),s&&s(m)});let n=d?r[0]:r;if(u==="jpg"||u==="jpeg"||u==="webp"){var a;n=(a=n.renderTarget)==null?void 0:a.texture}return n.mapping=l?Mn:Sn,"colorSpace"in n?n.colorSpace=i??l?"srgb":"srgb-linear":n.encoding=i??l?kr:jr,n}const Tr={files:nt,path:"",preset:void 0,extensions:void 0};Me.preload=e=>{const t={...Tr,...e};let{files:o,path:i=""}=t;const{preset:s,extensions:c}=t;s&&(rt(s),o=ve[s],i=Zt);const{extension:d}=ot(o);if(d==="webp"||d==="jpg"||d==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const u=it(d);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+o);U.preload(u,le(o)?[o]:o,l=>{l.setPath==null||l.setPath(i),c&&c(l)})};const Lr={files:nt,preset:void 0};Me.clear=e=>{const t={...Lr,...e};let{files:o}=t;const{preset:i}=t;i&&(rt(i),o=ve[i]);const{extension:s}=ot(o),c=it(s);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+o);U.clear(c,le(o)?[o]:o)};function rt(e){if(!(e in ve))throw new Error("Preset must be one of: "+Object.keys(ve).join(", "))}function ot(e){var t;const o=le(e)&&e.length===6,i=le(e)&&e.length===3&&e.some(d=>d.endsWith("json")),s=le(e)?e[0]:e;return{extension:o?"cube":i?"webp":s.startsWith("data:application/exr")?"exr":s.startsWith("data:application/hdr")?"hdr":s.startsWith("data:image/jpeg")?"jpg":(t=s.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:o,isGainmap:i}}function it(e){return e==="cube"?Rn:e==="hdr"?Dn:e==="exr"?In:e==="jpg"||e==="jpeg"?Bn:e==="webp"?Hn:null}const Ar=e=>e.current&&e.current.isScene,zr=e=>Ar(e)?e.current:e;function st(e,t,o,i,s={}){var c,d,u,l,v;s={backgroundBlurriness:(c=s.blur)!==null&&c!==void 0?c:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...s};const r=zr(t||o),n=r.background,a=r.environment,m={backgroundBlurriness:r.backgroundBlurriness,backgroundIntensity:r.backgroundIntensity,backgroundRotation:(d=(u=r.backgroundRotation)==null||u.clone==null?void 0:u.clone())!==null&&d!==void 0?d:[0,0,0],environmentIntensity:r.environmentIntensity,environmentRotation:(l=(v=r.environmentRotation)==null||v.clone==null?void 0:v.clone())!==null&&l!==void 0?l:[0,0,0]};return e!=="only"&&(r.environment=i),e&&(r.background=i),J(r,s),()=>{e!=="only"&&(r.environment=a),e&&(r.background=n),J(r,m)}}function at({scene:e,background:t=!1,map:o,...i}){const s=F(c=>c.scene);return f.useLayoutEffect(()=>{if(o)return st(t,e,s,o,i)}),null}function Jt({background:e=!1,scene:t,blur:o,backgroundBlurriness:i,backgroundIntensity:s,backgroundRotation:c,environmentIntensity:d,environmentRotation:u,...l}){const v=Me(l),r=F(n=>n.scene);return f.useLayoutEffect(()=>st(e,t,r,v,{blur:o,backgroundBlurriness:i,backgroundIntensity:s,backgroundRotation:c,environmentIntensity:d,environmentRotation:u})),null}function Dr({children:e,near:t=1,far:o=1e3,resolution:i=256,frames:s=1,map:c,background:d=!1,blur:u,backgroundBlurriness:l,backgroundIntensity:v,backgroundRotation:r,environmentIntensity:n,environmentRotation:a,scene:m,files:g,path:b,preset:h=void 0,extensions:p}){const y=F(j=>j.gl),C=F(j=>j.scene),S=f.useRef(null),[P]=f.useState(()=>new Pe),w=f.useMemo(()=>{const j=new On(i);return j.texture.type=Rt,j},[i]);f.useLayoutEffect(()=>(s===1&&S.current.update(y,P),st(d,m,C,w.texture,{blur:u,backgroundBlurriness:l,backgroundIntensity:v,backgroundRotation:r,environmentIntensity:n,environmentRotation:a})),[e,P,w.texture,m,C,d,s,y]);let k=1;return ge(()=>{(s===1/0||k<s)&&(S.current.update(y,P),k++)}),f.createElement(f.Fragment,null,Vt(f.createElement(f.Fragment,null,e,f.createElement("cubeCamera",{ref:S,args:[t,o,w]}),g||h?f.createElement(Jt,{background:!0,files:g,preset:h,path:b,extensions:p}):c?f.createElement(at,{background:!0,map:c,extensions:p}):null),P))}function Ir(e){var t,o,i,s;const c=Me(e),d=e.map||c;f.useMemo(()=>Tt({GroundProjectedEnvImpl:Fn}),[]);const u=f.useMemo(()=>[d],[d]),l=(t=e.ground)==null?void 0:t.height,v=(o=e.ground)==null?void 0:o.radius,r=(i=(s=e.ground)==null?void 0:s.scale)!==null&&i!==void 0?i:1e3;return f.createElement(f.Fragment,null,f.createElement(at,Q({},e,{map:d})),f.createElement("groundProjectedEnvImpl",{args:u,scale:r,height:l,radius:v}))}function io(e){return e.ground?f.createElement(Ir,e):e.map?f.createElement(at,e):e.children?f.createElement(Dr,e):f.createElement(Jt,e)}const so=f.forwardRef(({args:e,map:t,toneMapped:o=!1,color:i="white",form:s="rect",intensity:c=1,scale:d=1,target:u,children:l,...v},r)=>{const n=f.useRef(null);return f.useImperativeHandle(r,()=>n.current,[]),f.useLayoutEffect(()=>{!l&&!v.material&&(J(n.current.material,{color:i}),n.current.material.color.multiplyScalar(c))},[i,c,l,v.material]),f.useLayoutEffect(()=>{u&&n.current.lookAt(Array.isArray(u)?new X(...u):u)},[u]),d=Array.isArray(d)&&d.length===2?[d[0],d[1],1]:d,f.createElement("mesh",Q({ref:n,scale:d},v),s==="circle"?f.createElement("ringGeometry",{args:[0,1,64]}):s==="ring"?f.createElement("ringGeometry",{args:[.5,1,64]}):s==="rect"?f.createElement("planeGeometry",null):f.createElement(s,{args:e}),l||(v.material?null:f.createElement("meshBasicMaterial",{toneMapped:o,map:t,side:St})))}),Fr=e=>e&&e.isOrthographicCamera,Ct=new xt,Qt=$n();function en(e){return"top"in e}function He(e,t){const{right:o,top:i,left:s,bottom:c,width:d,height:u}=t,l=t.bottom<0||i>e.height||o<0||t.left>e.width;if(en(e)){const n=e.top+e.height-c,a=s-e.left;return{position:{width:d,height:u,left:a,top:i,bottom:n,right:o},isOffscreen:l}}const v=e.height-c;return{position:{width:d,height:u,top:i,left:s,bottom:v,right:o},isOffscreen:l}}function $e(e,{left:t,bottom:o,width:i,height:s}){let c;const d=i/s;return Fr(e.camera)?(e.camera.left!==i/-2||e.camera.right!==i/2||e.camera.top!==s/2||e.camera.bottom!==s/-2)&&(Object.assign(e.camera,{left:i/-2,right:i/2,top:s/2,bottom:s/-2}),e.camera.updateProjectionMatrix()):e.camera.aspect!==d&&(e.camera.aspect=d,e.camera.updateProjectionMatrix()),c=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,o,i,s),e.gl.setScissor(t,o,i,s),e.gl.setScissorTest(!0),c}function We(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function Pt(e){e.gl.getClearColor(Ct),e.gl.setClearColor(Ct,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function Br({visible:e=!0,canvasSize:t,scene:o,index:i,children:s,frames:c,rect:d,track:u}){const l=F(),[v,r]=f.useState(!1);let n=0;return ge(a=>{if(c===1/0||n<=c){var m;u&&(d.current=(m=u.current)==null?void 0:m.getBoundingClientRect()),n++}if(d.current){const{position:g,isOffscreen:b}=He(t,d.current);if(v!==b&&r(b),e&&!v&&d.current){const h=$e(a,g);a.gl.render(s?a.scene:o,a.camera),We(a,h)}}},i),f.useLayoutEffect(()=>{const a=d.current;if(a&&(!e||!v)){const{position:m}=He(t,a),g=$e(l,m);Pt(l),We(l,g)}},[e,v]),f.useEffect(()=>{if(!u)return;const a=d.current,m=l.get().events.connected;return l.setEvents({connected:u.current}),()=>{if(a){const{position:g}=He(t,a),b=$e(l,g);Pt(l),We(l,b)}l.setEvents({connected:m})}},[u]),f.useEffect(()=>{en(t)||console.warn(`Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.
 See https://github.com/pmndrs/drei/issues/944`)},[]),f.createElement(f.Fragment,null,s,f.createElement("group",{onPointerOver:()=>null}))}const tn=f.forwardRef(({track:e,visible:t=!0,index:o=1,id:i,style:s,className:c,frames:d=1/0,children:u,...l},v)=>{var r,n,a,m;const g=f.useRef(null),{size:b,scene:h}=F(),[p]=f.useState(()=>new Pe),[y,C]=f.useReducer(()=>!0,!1),S=f.useCallback((P,w)=>{if(g.current&&e&&e.current&&P.target===e.current){const{width:k,height:j,left:R,top:T}=g.current,_=P.clientX-R,z=P.clientY-T;w.pointer.set(_/k*2-1,-(z/j)*2+1),w.raycaster.setFromCamera(w.pointer,w.camera)}},[g,e]);return f.useEffect(()=>{var P;e&&(g.current=(P=e.current)==null?void 0:P.getBoundingClientRect()),C()},[e]),f.createElement("group",Q({ref:v},l),y&&Vt(f.createElement(Br,{visible:t,canvasSize:b,frames:d,scene:h,track:e,rect:g,index:o},u),p,{events:{compute:S,priority:o},size:{width:(r=g.current)==null?void 0:r.width,height:(n=g.current)==null?void 0:n.height,top:(a=g.current)==null?void 0:a.top,left:(m=g.current)==null?void 0:m.left}}))}),Hr=f.forwardRef(({as:e="div",id:t,visible:o,className:i,style:s,index:c=1,track:d,frames:u=1/0,children:l,...v},r)=>{const n=f.useId(),a=f.useRef(null);return f.useImperativeHandle(r,()=>a.current),f.createElement(f.Fragment,null,f.createElement(e,Q({ref:a,id:t,className:i,style:s},v)),f.createElement(Qt.In,null,f.createElement(tn,{visible:o,key:n,track:a,frames:u,index:c},l)))}),$r=f.forwardRef((e,t)=>f.useContext(xe)?f.createElement(tn,Q({ref:t},e)):f.createElement(Hr,Q({ref:t},e)));$r.Port=()=>f.createElement(Qt.Out,null);export{to as C,io as E,no as H,so as L,oo as O,ro as P,$r as V,Xt as a,eo as g,tt as u};
